const imageCache=new Map;function preloadImage(e){return new Promise((t,a)=>{if(imageCache.has(e))return void t({url:e,fromCache:!0,cached:imageCache.get(e)});const o=new Image;o.onload=function(){imageCache.set(e,o),t({url:e,fromCache:!1,cached:o})},o.onerror=function(){a(new Error(`图片加载失败: ${e}`))},o.src=e})}function showLoadingStatus(e,t=!1){let a=document.getElementById("wallpaper-loading-indicator");a||(a=document.createElement("div"),a.id="wallpaper-loading-indicator",a.className="wallpaper-loading-indicator",document.body.appendChild(a)),a.innerHTML=`\n    <div class="loading-spinner"></div>\n    <div class="status-text">${e}</div>\n    ${t?'<div class="cache-status">来自缓存</div>':""}\n  `,setTimeout(()=>{a.classList.add("show")},10)}function hideLoadingStatus(){const e=document.getElementById("wallpaper-loading-indicator");e&&(e.classList.remove("show"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300))}function preloadRecentWallpapers(){JSON.parse(localStorage.getItem("recentWallpapers")||"[]").slice(0,3).forEach(e=>{preloadImage(e).catch(e=>{console.log("预加载失败:",e.message)})})}function addToRecentWallpapers(e){let t=JSON.parse(localStorage.getItem("recentWallpapers")||"[]");t=t.filter(t=>t!==e),t.unshift(e),t.length>10&&(t=t.slice(0,10)),localStorage.setItem("recentWallpapers",JSON.stringify(t))}function setWallpaper(e){let t="";if(e.startsWith("gradient")){const a=parseInt(e.replace("gradient",""))-1,o=getGradientPairs();if(a>=0&&a<o.length){const[e,r]=o[a];t=`linear-gradient(135deg, ${e} 0%, ${r} 100%)`}}const a=document.getElementById("wallpaperContainer");t?(a.style.background=t,localStorage.setItem("customWallpaper",t)):(a.style.background="",localStorage.removeItem("customWallpaper"))}async function setCustomWallpaper(){const e=document.getElementById("customWallpaperUrl").value.trim();if(e){showLoadingStatus("正在加载壁纸...");try{(await preloadImage(e)).fromCache?showLoadingStatus("从缓存加载壁纸...",!0):showLoadingStatus("壁纸加载完成");const t=`url('${e}') center/cover no-repeat`;document.getElementById("wallpaperContainer").style.background=t,localStorage.setItem("customWallpaper",t),localStorage.setItem("customWallpaperUrl",e),addToRecentWallpapers(e),setTimeout(()=>{hideLoadingStatus()},1e3)}catch(e){showLoadingStatus("图片加载失败，请检查URL是否正确"),setTimeout(()=>{hideLoadingStatus()},3e3),console.error("图片加载失败:",e.message)}}else alert("请输入图片URL")}function getCurrentDirection(){const e=document.querySelector(".direction-btn.active");return e?e.dataset.direction:"135deg"}function updateGradientPreview(){const e=document.getElementById("color1").value,t=document.getElementById("color2").value,a=`linear-gradient(${getCurrentDirection()}, ${e} 0%, ${t} 100%)`;document.getElementById("gradientPreview").style.background=a}function getAllColors(){return["#667eea","#764ba2","#f093fb","#f5576c","#4ecdc4","#44a08d","#ff6b6b","#45b7d1","#96c93d","#feca57","#ff9ff3","#54a0ff","#5f27cd","#00d2d3","#ff9f43","#10ac84","#ee5a24","#0abde3","#006ba6","#f38ba8","#a8e6cf","#ffd93d","#6c5ce7"]}function getGradientPairs(){const e=getAllColors();return[[e[0],e[1]],[e[2],e[3]],[e[4],e[5]],[e[6],e[7]],[e[0],e[2]]]}function randomColors(){const e=getAllColors(),t=e[Math.floor(Math.random()*e.length)];let a=e[Math.floor(Math.random()*e.length)];for(;a===t;)a=e[Math.floor(Math.random()*e.length)];document.getElementById("color1").value=t,document.getElementById("color2").value=a;const o=["135deg","45deg","90deg","0deg"],r=o[Math.floor(Math.random()*o.length)];document.querySelectorAll(".direction-btn").forEach(e=>{e.classList.toggle("active",e.dataset.direction===r)}),updateGradientPreview()}function updateSVGWallpaper(){const e=document.getElementById("svgCode").value,t=document.getElementById("svgWallpaper");if(t&&t.remove(),!e||""===e.trim()){const e=localStorage.getItem("customWallpaper");if(e){document.getElementById("wallpaperContainer").style.background=e}else setWallpaper("default");return void localStorage.removeItem("svgWallpaper")}const a=document.getElementById("wallpaperContainer"),o=document.createElement("div");o.id="svgWallpaper",o.className="svg-wallpaper";try{const t=(new DOMParser).parseFromString(e,"image/svg+xml"),r=t.querySelector("parsererror");if(r)throw new Error("SVG解析错误："+r.textContent);const n=t.documentElement;if("svg"!==n.nodeName)throw new Error("请输入有效的SVG代码");n.setAttribute("width","100%"),n.setAttribute("height","100%"),n.setAttribute("preserveAspectRatio","xMidYMid slice"),o.appendChild(n),a.appendChild(o),a.style.background="",localStorage.setItem("svgWallpaper","active")}catch(e){console.error("SVG代码错误：",e.message),o.remove()}}function applyCustomGradient(){const e=document.getElementById("color1").value,t=document.getElementById("color2").value,a=`linear-gradient(${getCurrentDirection()}, ${e} 0%, ${t} 100%)`;document.getElementById("wallpaperContainer").style.background=a,localStorage.setItem("customWallpaper",a)}function initColorMixer(){document.querySelectorAll(".direction-btn").forEach(e=>{e.addEventListener("click",function(){document.querySelectorAll(".direction-btn").forEach(e=>e.classList.remove("active")),this.classList.add("active"),updateGradientPreview()})}),document.getElementById("color1").addEventListener("input",updateGradientPreview),document.getElementById("color2").addEventListener("input",updateGradientPreview),updateGradientPreview()}export{setWallpaper,setCustomWallpaper,preloadImage,showLoadingStatus,hideLoadingStatus,preloadRecentWallpapers,addToRecentWallpapers,getCurrentDirection,updateGradientPreview,getAllColors,getGradientPairs,randomColors,updateSVGWallpaper,applyCustomGradient,initColorMixer};