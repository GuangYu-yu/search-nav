import{links,resources,initializeDataPreview}from"./dataManager.js";import{getCachedFaviconUrl,getFaviconUrl,formatUrl,clearDomainCache,showEditDialog,showEditResourceDialog,deleteLink,deleteResource}from"./linkManager.js";function calculateGridLayout(e){if(e<=5)return{columns:e,rows:1};const t=Math.ceil(e/5);return{columns:Math.ceil(e/t),rows:t}}function renderQuickLinks(){const e=document.getElementById("quickLinksContainer");if(e.innerHTML="",!links.length)return;const t=calculateGridLayout(links.length);e.style.gridTemplateColumns=`repeat(${t.columns}, 80px)`,e.style.gridTemplateRows=`repeat(${t.rows}, 1fr)`;const n=document.createDocumentFragment();links.forEach(e=>{const t=document.createElement("div");t.className="quick-link",t.onclick=()=>window.location.href=e.url;const c=document.createElement("div");c.className="quick-link-icon",c.style.backgroundImage=`url('${e.faviconUrl||getCachedFaviconUrl(e.url)}')`;const o=document.createElement("div");o.className="quick-link-name",o.textContent=e.name,t.append(c,o),n.appendChild(t)}),e.appendChild(n),e.classList.toggle("overflowing",t.rows>3)}function openSettings(){document.getElementById("settingsModal").classList.add("show"),renderLinks()}function closeSettings(){document.getElementById("settingsModal").classList.remove("show")}function switchTab(e){document.querySelectorAll(".tab-btn").forEach(t=>{t.classList.toggle("active",t.dataset.tab===e)}),document.querySelectorAll(".tab-content").forEach(t=>{t.classList.toggle("active",t.id===e+"-tab")})}function renderListItems(e,t,n){const c=document.getElementById(e);c.innerHTML="",t.forEach((e,t)=>{const o=document.createElement("div");o.className="link-item",o.id=`${n}-${t}`;const i=document.createElement("div");i.className="link-favicon",i.style.backgroundImage=`url('${e.faviconUrl}')`;const s=document.createElement("div");s.className="link-details";const a=document.createElement("div");a.className="link-name",a.textContent=e.name;const l=document.createElement("div");l.className="link-url",l.textContent=e.url,s.appendChild(a),s.appendChild(l);const r=document.createElement("div");r.className="link-actions";const d=document.createElement("button");d.className="edit-btn",d.textContent="修改";const u=document.createElement("button");u.className="delete-btn",u.textContent="删除","link"===n?(d.onclick=()=>showEditDialog(t),u.onclick=()=>deleteLink(t)):"resource"===n&&(d.onclick=()=>showEditResourceDialog(t),u.onclick=()=>deleteResource(t)),r.appendChild(d),r.appendChild(u),o.appendChild(i),o.appendChild(s),o.appendChild(r),c.appendChild(o)})}function renderLinks(){renderListItems("linksContainer",links,"link")}function renderResources(){renderListItems("resourcesContainer",resources,"resource")}function saveLink(e,t,n,c=""){if(!n)return void alert("请填写网站地址");const o=formatUrl(n);clearDomainCache(links[e].url);const i=c||getFaviconUrl(o);links[e]={name:t,url:o,faviconUrl:i},localStorage.setItem("navLinks",JSON.stringify(links)),renderLinks(),renderQuickLinks(),initializeDataPreview()}function applyFocusTransition(e){e?document.body.classList.add("search-focused"):document.body.classList.remove("search-focused")}document.addEventListener("click",function(e){const t=document.getElementById("themeSwitcher"),n=document.querySelector(".theme-toggle-btn"),c=document.getElementById("engineDropdown"),o=document.querySelector(".engine-selector");if(t.contains(e.target)||n.contains(e.target)||t.classList.remove("show"),!c.contains(e.target)&&!o.contains(e.target)){c.classList.remove("show");document.getElementById("suggestionsContainer").style.opacity=""}});export{calculateGridLayout,renderQuickLinks,openSettings,closeSettings,switchTab,renderLinks,renderResources,saveLink,applyFocusTransition};