import{links,resources,initializeDataPreview}from"./dataManager.js";import{getCachedFaviconUrl,getFaviconUrl,formatUrl,clearDomainCache,showEditDialog,showEditResourceDialog,deleteLink,deleteResource}from"./linkManager.js";function calculateGridLayout(e){if(e<=5)return{columns:e,rows:1};const t=Math.ceil(e/5);return{columns:Math.ceil(e/t),rows:t}}function renderQuickLinks(){const e=document.getElementById("quickLinksContainer");if(e.innerHTML="",!links.length)return;const t=calculateGridLayout(links.length);e.style.gridTemplateColumns=`repeat(${t.columns}, 80px)`,e.style.gridTemplateRows=`repeat(${t.rows}, 1fr)`;const n=document.createDocumentFragment();links.forEach(e=>{const t=document.createElement("div");t.className="quick-link",t.onclick=()=>window.location.href=e.url;const o=document.createElement("div");o.className="quick-link-icon",o.style.backgroundImage=`url('${e.faviconUrl||getCachedFaviconUrl(e.url)}')`;const c=document.createElement("div");c.className="quick-link-name",c.textContent=e.name,t.append(o,c),n.appendChild(t)}),e.appendChild(n),e.classList.toggle("overflowing",t.rows>3)}function openSettings(){document.getElementById("settingsModal").classList.add("show"),document.body.classList.add("settings-modal-open"),renderLinks()}function closeSettings(){document.getElementById("settingsModal").classList.remove("show"),document.body.classList.remove("settings-modal-open")}function switchTab(e){document.querySelectorAll(".tab-btn").forEach(t=>{t.classList.toggle("active",t.dataset.tab===e)}),document.querySelectorAll(".tab-content").forEach(t=>{t.classList.toggle("active",t.id===e+"-tab")})}function renderListItems(e,t,n){const o=document.getElementById(e);o.innerHTML="",t.forEach((e,t)=>{const c=document.createElement("div");c.className="link-item",c.id=`${n}-${t}`;const s=document.createElement("div");s.className="link-favicon",s.style.backgroundImage=`url('${e.faviconUrl}')`;const i=document.createElement("div");i.className="link-details";const a=document.createElement("div");a.className="link-name",a.textContent=e.name;const l=document.createElement("div");l.className="link-url",l.textContent=e.url,i.appendChild(a),i.appendChild(l);const r=document.createElement("div");r.className="link-actions";const d=document.createElement("button");d.className="edit-btn",d.textContent="修改";const m=document.createElement("button");m.className="delete-btn",m.textContent="删除","link"===n?(d.onclick=()=>showEditDialog(t),m.onclick=()=>deleteLink(t)):"resource"===n&&(d.onclick=()=>showEditResourceDialog(t),m.onclick=()=>deleteResource(t)),r.appendChild(d),r.appendChild(m),c.appendChild(s),c.appendChild(i),c.appendChild(r),o.appendChild(c)})}function renderLinks(){renderListItems("linksContainer",links,"link")}function renderResources(){renderListItems("resourcesContainer",resources,"resource")}function saveLink(e,t,n,o=""){if(!n)return void alert("请填写网站地址");const c=formatUrl(n);clearDomainCache(links[e].url);const s=o||getFaviconUrl(c);links[e]={name:t,url:c,faviconUrl:s},localStorage.setItem("navLinks",JSON.stringify(links)),renderLinks(),renderQuickLinks(),initializeDataPreview()}function applyFocusTransition(e){e?document.body.classList.add("search-focused"):document.body.classList.remove("search-focused")}document.addEventListener("click",function(e){const t=document.getElementById("themeSwitcher"),n=document.querySelector(".theme-toggle-btn"),o=document.getElementById("engineDropdown"),c=document.querySelector(".engine-selector");if(t.contains(e.target)||n.contains(e.target)||t.classList.remove("show"),!o.contains(e.target)&&!c.contains(e.target)){o.classList.remove("show");document.getElementById("suggestionsContainer").style.opacity=""}});export{calculateGridLayout,renderQuickLinks,openSettings,closeSettings,switchTab,renderLinks,renderResources,saveLink,applyFocusTransition};